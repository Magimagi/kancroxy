(function(){var database,fs,mime,querystring,storagePath,url,util;fs=require("fs");url=require("url");mime=require("mime");util=require("./util");querystring=require("querystring");database=window.localStorage;storagePath=global.appDataPath+"/storage";exports.loadStorageFile=function(req,res){var data,filePath,parsed;parsed=url.parse(req.url);filePath=""+storagePath+parsed.pathname;if(!(fs.existsSync(filePath)&&querystring.parse(parsed.query).VERSION===database.getItem(filePath))){return false}util.log("读取游戏缓存 "+filePath);data=fs.readFileSync(filePath);res.writeHead(200,{"Content-Type":mime.lookup(filePath),"Content-Length":data.length});res.write(data);res.end();return true};exports.saveStorageFile=function(req,data){var filePath,parsed;parsed=url.parse(req.url);filePath=""+storagePath+parsed.pathname;util.log("保存游戏缓存 "+filePath);util.guaranteeFilePath(filePath);fs.writeFileSync(filePath,data);return database.setItem(filePath,querystring.parse(parsed.query).VERSION)}}).call(this);