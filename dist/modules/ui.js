(function(){var $,Notification,antiCatCounter,api_start2,api_start2_filePath,api_start2_realPath,config,createItem,decks,exp,fs,getMaterialImgTag,getMaterialImgTag2,kdockNoticed,kdockTimer,kdocks,mapareas,maps,materials,materialsName,missionNoticed,missionTimer,missions,ndockNoticed,ndockTimer,ndocks,ownShips,ownSlotitems,proxy,rankName,ships,showNotification,slotitems,state,stypes,timer,user,util;config=require("./config");proxy=config.config.proxy;util=require("./util");fs=require("fs");$=global.$;Notification=global.Notification;materialsName=["","油","弹","钢","铝","高速建造","高速修复","开发资材","改修资材"];rankName=["","元帥","大将","中将","少将","大佐","中佐","新米中佐","少佐","中堅少佐","新米少佐"];exp=[0,0,100,300,600,1e3,1500,2100,2800,3600,4500,5500,6600,7800,9100,10500,12e3,13600,15300,17100,19e3,21e3,23100,25300,27600,3e4,32500,35100,37800,40600,43500,46500,49600,52800,56100,59500,63e3,66600,70300,74100,78e3,82e3,86100,90300,94600,99e3,103500,108100,112800,117600,122500,127500,132700,138100,143700,149500,155500,161700,168100,174700,181500,188500,195800,203400,211300,219500,228e3,236800,245900,255300,265e3,275e3,285400,296200,307400,319e3,331e3,343400,356200,369400,383e3,397e3,411500,426500,442e3,458e3,474500,491500,509e3,527e3,545500,564500,584500,606500,631500,661500,701500,761500,851500,1e6,1e6,101e4,1011e3,1013e3,1016e3,102e4,1025e3,1031e3,1038e3,1046e3,1055e3,1065e3,1077e3,1091e3,1107e3,1125e3,1145e3,1168e3,1194e3,1223e3,1255e3,129e4,1329e3,1372e3,1419e3,147e4,1525e3,1584e3,1647e3,1714e3,1785e3,186e4,194e4,2025e3,2115e3,221e4,231e4,2415e3,2525e3,264e4,276e4,2887e3,3021e3,3162e3,331e4,3465e3,3628e3,3799e3,3978e3,4165e3,436e4,436e4];state=false;antiCatCounter=0;missionTimer=[-1,-1,-1,-1,-1];missionNoticed=[false,false,false,false,false];ndockTimer=[-1,-1,-1,-1,-1];ndockNoticed=[false,false,false,false,false];kdockTimer=[-1,-1,-1,-1,-1];kdockNoticed=[false,false,false,false,false];user=null;createItem=null;ships=[];stypes=[];mapareas=[];maps=[];missions=[];slotitems=[];ownShips=[];ownSlotitems=[];materials=[];decks=[];ndocks=[];kdocks=[];exports.updatePacPath=function(path){return $("#pac-path")[0].value="file://"+path};exports.showNotification=showNotification=function(body){var notification;notification=new Notification("Poi",{icon:"icon.png",body:body});return notification.onclick=function(){return notification.close()}};timer=function(){var i,_i,_len,_ref,_results;_ref=[1,2,3,4];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){i=_ref[_i];if(missionTimer[i]>0){missionTimer[i]-=1}if(missionTimer[i]>=0){$("#mission-timer-"+i).text(util.formatTime(missionTimer[i]));if(missionTimer[i]<=45&&!missionNoticed[i]){showNotification($("#mission-name-"+i).text()+"远征归来");missionNoticed[i]=true}}else{$("#mission-timer-"+i).text("")}if(ndockTimer[i]>0){ndockTimer[i]-=1}if(ndockTimer[i]>=0){$("#ndock-timer-"+i).text(util.formatTime(ndockTimer[i]));if(ndockTimer[i]<=45&&!ndockNoticed[i]){showNotification($("#ndock-name-"+i).text()+"修复完成");ndockNoticed[i]=true}}else{$("#ndock-timer-"+i).text("")}if(kdockTimer[i]>0){kdockTimer[i]-=1}if(kdockTimer[i]>=0){$("#kdock-timer-"+i).text(util.formatTime(kdockTimer[i]));$("#kdock-"+i+"-remaining").text(util.formatTime(kdockTimer[i]));if(kdockTimer[i]<=45&&!kdockNoticed[i]){showNotification($("#kdock-name-"+i).text()+"建造完成");_results.push(kdockNoticed[i]=true)}else{_results.push(void 0)}}else{$("#kdock-timer-"+i).text("");_results.push($("#kdock-"+i+"-remaining").text(""))}}return _results};exports.showModal=function(title,content){$("#modal-message-title").text(title);$("#modal-message-content").text(content);return $("#modal-message").modal()};exports.showModalHtml=function(title,content){$("#modal-message-title").html(title);$("#modal-message-content").html(content);return $("#modal-message").modal()};exports.initConfig=function(){if(proxy.useShadowsocks){$("#current-proxy").text("shadowsocks");$("#shadowsocks-tab-li").addClass("am-active");$("#shadowsocks-tab").addClass("am-in am-active")}else if(proxy.useHttpProxy){$("#current-proxy").text("http");$("#http-tab-li").addClass("am-active");$("#http-tab").addClass("am-in am-active")}else if(proxy.useSocksProxy){$("#current-proxy").text("socks");$("#socks-tab-li").addClass("am-active");$("#socks-tab").addClass("am-in am-active")}else{$("#current-proxy").text("none");$("#none-tab-li").addClass("am-active");$("#none-tab").addClass("am-in am-active")}$("#shadowsocks-server-ip")[0].value=proxy.shadowsocks.serverIp;$("#shadowsocks-server-port")[0].value=proxy.shadowsocks.serverPort;$("#shadowsocks-password")[0].value=proxy.shadowsocks.password;$("#shadowsocks-method")[0].value=proxy.shadowsocks.method;$("#httpproxy-ip")[0].value=proxy.httpProxy.httpProxyIp;$("#httpproxy-port")[0].value=proxy.httpProxy.httpProxyPort;$("#socksproxy-ip")[0].value=proxy.socksProxy.socksProxyIp;return $("#socksproxy-port")[0].value=proxy.socksProxy.socksProxyPort};exports.saveConfig=function(){var conf;conf=config.config;conf.proxy.useShadowsocks=$("#current-proxy").text()==="shadowsocks";conf.proxy.shadowsocks.serverIp=$("#shadowsocks-server-ip")[0].value;conf.proxy.shadowsocks.serverPort=$("#shadowsocks-server-port")[0].value;conf.proxy.shadowsocks.password=$("#shadowsocks-password")[0].value;conf.proxy.shadowsocks.method=$("#shadowsocks-method")[0].value;conf.proxy.useHttpProxy=$("#current-proxy").text()==="http";conf.proxy.httpProxy.httpProxyIp=$("#httpproxy-ip")[0].value;conf.proxy.httpProxy.httpProxyPort=$("#httpproxy-port")[0].value;conf.proxy.useSocksProxy=$("#current-proxy").text()==="socks";conf.proxy.socksProxy.socksProxyIp=$("#socksproxy-ip")[0].value;conf.proxy.socksProxy.socksProxyPort=$("#socksproxy-port")[0].value;if(config.updateConfig(conf)){return exports.showModal("保存设置","保存成功，重新启动软件后生效。")}else{return exports.showModal("保存设置","保存失败…")}};exports.turnOn=function(){if(!state){state=true;$("#state-panel-content").text("正常运行中");$("#poi-panel").hide();$("#user-panel").fadeIn();$("#resource-panel").fadeIn();$("#mission-panel").fadeIn();$("#ndocks-panel").fadeIn();$("#kdocks-panel").fadeIn();$("#log-panel").fadeIn();return setInterval(timer,1e3)}};exports.turnOff=function(){if(state){state=false;$("#state-panel-content").text("没有检测到流量");$("#user-panel").hide();$("#resource-panel").hide();$("#mission-panel").hide();$("#ndocks-panel").hide();$("#kdocks-panel").hide();$("#log-panel").hide();return $("#poi-panel").fadeIn()}};exports.addAntiCatCounter=function(){return $("#anticat-panel-content").text("一共抵御了"+(antiCatCounter+=1)+"次猫神的袭击……")};getMaterialImgTag=function(id){return'<img src="./assets/images/material/'+id+'.png" title="'+materialsName[id]+'" style="height: 30px; margin-right: 1px;">'};getMaterialImgTag2=function(id){return'<img src="./assets/images/material/'+id+'.png" title="'+materialsName[id]+'" style="height: 30px; margin-right: 20px;">'};api_start2_filePath="data/api_start2.json";api_start2_realPath=global.appDataPath+"/"+api_start2_filePath;exports.api_start2_loadDefault=function(){var data,err;data=[];try{data=JSON.parse(fs.readFileSync(api_start2_realPath))}catch(_error){err=_error;data=JSON.parse(fs.readFileSync(api_start2_filePath))}return api_start2(data)};exports.api_start2=api_start2=function(data){var api_data,map,maparea,mission,ship,slotitem,stype,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_len5,_m,_n,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;api_data=data.api_data;ships=[];_ref=api_data.api_mst_ship;for(_i=0,_len=_ref.length;_i<_len;_i++){ship=_ref[_i];ships[ship.api_id]=ship}stypes=[];_ref1=api_data.api_mst_stype;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){stype=_ref1[_j];stypes[stype.api_id]=stype}slotitems=[];_ref2=api_data.api_mst_slotitem;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){slotitem=_ref2[_k];slotitems[slotitem.api_id]=slotitem}mapareas=[];_ref3=api_data.api_mst_maparea;for(_l=0,_len3=_ref3.length;_l<_len3;_l++){maparea=_ref3[_l];mapareas[maparea.api_id]=maparea}maps=[];_ref4=api_data.api_mst_mapinfo;for(_m=0,_len4=_ref4.length;_m<_len4;_m++){map=_ref4[_m];maps[map.api_id]=map}missions=[];_ref5=api_data.api_mst_mission;for(_n=0,_len5=_ref5.length;_n<_len5;_n++){mission=_ref5[_n];missions[mission.api_id]=mission}util.guaranteeFilePath(api_start2_realPath);return fs.writeFile(api_start2_realPath,JSON.stringify(data),function(err){if(err!=null){return console.log(err)}})};exports.api_get_member_basic=function(api_data){return user=api_data};exports.api_get_member_slot_item=function(api_data){var slotitem,_i,_len,_results;ownSlotitems=[];_results=[];for(_i=0,_len=api_data.length;_i<_len;_i++){slotitem=api_data[_i];_results.push(ownSlotitems[slotitem.api_id]=slotitem)}return _results};exports.api_port_port=function(api_data){var deck,material,ndock,ship,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3;material=[];_ref=api_data.api_material;for(_i=0,_len=_ref.length;_i<_len;_i++){material=_ref[_i];materials[material.api_id]=material}ownShips=[];_ref1=api_data.api_ship;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){ship=_ref1[_j];ownShips[ship.api_id]=ship}decks=[];_ref2=api_data.api_deck_port;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){deck=_ref2[_k];decks[deck.api_id]=deck}ndocks=[];_ref3=api_data.api_ndock;for(_l=0,_len3=_ref3.length;_l<_len3;_l++){ndock=_ref3[_l];ndocks[ndock.api_id]=ndock}return user=api_data.api_basic};exports.api_get_member_kdock=function(api_data){var kdock,_i,_len,_results;kdocks=[];_results=[];for(_i=0,_len=api_data.length;_i<_len;_i++){kdock=api_data[_i];_results.push(kdocks[kdock.api_id]=kdock)}return _results};exports.api_get_member_ship2=function(data){var deck,ship,_i,_j,_len,_len1,_ref,_ref1,_results;ownShips=[];_ref=data.api_data;for(_i=0,_len=_ref.length;_i<_len;_i++){ship=_ref[_i];ownShips[ship.api_id]=ship}decks=[];_ref1=data.api_data_deck;_results=[];for(_j=0,_len1=_ref1.length;_j<_len1;_j++){deck=_ref1[_j];_results.push(decks[deck.api_id]=deck)}return _results};exports.api_get_member_ship3=function(api_data){var deck,ship,_i,_j,_len,_len1,_ref,_ref1,_results;ownShips=[];_ref=api_data.api_ship_data;for(_i=0,_len=_ref.length;_i<_len;_i++){ship=_ref[_i];ownShips[ship.api_id]=ship}decks=[];_ref1=api_data.api_deck_data;_results=[];for(_j=0,_len1=_ref1.length;_j<_len1;_j++){deck=_ref1[_j];_results.push(decks[deck.api_id]=deck)}return _results};exports.api_req_hokyu_charge=function(api_data){var k,ship,shipId,v,_i,_len,_ref,_results;_ref=api_data.api_ship;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){ship=_ref[_i];shipId=ship.api_id;_results.push(function(){var _results1;_results1=[];for(k in ship){v=ship[k];_results1.push(ownShips[shipId][k]=v)}return _results1}())}return _results};exports.api_req_kousyou_createitem=function(api_data){createItem=api_data;if(api_data.api_create_flag===1){return ownSlotitems[api_data.api_slot_item.api_id]=api_data.api_slot_item}};exports.api_req_kousyou_getship=function(api_data){var kdock,_i,_len,_ref;kdocks=[];_ref=api_data.api_kdock;for(_i=0,_len=_ref.length;_i<_len;_i++){kdock=_ref[_i];kdocks[kdock.api_id]=kdock}return ownShips[api_data.api_ship.api_id]=api_data.api_ship};exports.api_req_kaisou_slotset=function(postData,api_data){var idx,itemId,shipId;shipId=parseInt(postData.api_id);itemId=parseInt(postData.api_item_id);idx=parseInt(postData.api_slot_idx);return ownShips[shipId].api_slot[idx]=itemId};exports.api_req_mission_start=function(postData,api_data){var deckId,missionId;deckId=parseInt(postData.api_deck_id);missionId=parseInt(postData.api_mission_id);decks[deckId].api_mission[0]=1;decks[deckId].api_mission[1]=missionId;return decks[deckId].api_mission[2]=api_data.api_complatetime};exports.api_req_hensei_change=function(postData,api_data){var cur,deck,deckId,i,j,ship,shipId,shipIdx,_i,_j,_k,_len,_len1,_ref;deckId=parseInt(postData.api_id);shipIdx=parseInt(postData.api_ship_idx);shipId=parseInt(postData.api_ship_id);if(shipId!==-1){cur=decks[deckId].api_ship[shipIdx];for(i=_i=0,_len=decks.length;_i<_len;i=++_i){deck=decks[i];if(deck==null){continue}_ref=deck.api_ship;for(j=_j=0,_len1=_ref.length;_j<_len1;j=++_j){ship=_ref[j];if(ship===shipId){decks[i].api_ship[j]=cur}}}return decks[deckId].api_ship[shipIdx]=shipId}else{for(i=_k=shipIdx;shipIdx<=4?_k<=4:_k>=4;i=shipIdx<=4?++_k:--_k){decks[deckId].api_ship[i]=decks[deckId].api_ship[i+1]}return decks[5]=-1}};exports.refreshUser=function(){var material,ship,shipCount,slotitem,slotitemCount,text,_i,_j,_k,_len,_len1,_len2,_results;text="Lv. "+user.api_level+" "+user.api_nickname+" ["+rankName[user.api_rank]+"]";$("#user-panel-title").text(text);shipCount=0;for(_i=0,_len=ownShips.length;_i<_len;_i++){ship=ownShips[_i];if(ship){shipCount+=1}}text="舰娘: "+shipCount+" / "+user.api_max_chara;$("#chara-info").text(text);slotitemCount=0;for(_j=0,_len1=ownSlotitems.length;_j<_len1;_j++){slotitem=ownSlotitems[_j];if(!slotitem){continue}slotitemCount+=1}text="装备: "+slotitemCount+" / "+user.api_max_slotitem;$("#equip-info").text(text);_results=[];for(_k=0,_len2=materials.length;_k<_len2;_k++){material=materials[_k];if(!material){continue}_results.push($("#material-"+material.api_id).html(getMaterialImgTag2(material.api_id)+" "+material.api_value))}return _results};exports.refreshDecks=function(){var basicSaku,bullChargeHtml,bullPercent,cur,currentState,deck,extraSaku,extraTyku,fuelChargeHtml,fuelPercent,hpPercent,html,i,ship,shipData,shipId,slot,slotData,slotId,slotPos,totalLv,totalSaku,totalShip,totalTyku,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_results;_results=[];for(_i=0,_len=decks.length;_i<_len;_i++){deck=decks[_i];if(deck==null){continue}totalLv=0;totalShip=0;totalSaku=0;totalTyku=0;$("#deckname-"+deck.api_id).text(deck.api_name);$("#mission-name-"+deck.api_id).text(deck.api_name);switch(deck.api_mission[0]){case 0:missionTimer[deck.api_id]=-1;break;case 1:missionTimer[deck.api_id]=Math.floor((deck.api_mission[2]-new Date)/1e3);missionNoticed[deck.api_id]=false;break;case 2:missionTimer[deck.api_id]=0;missionNoticed[deck.api_id]=false}_ref=deck.api_ship;for(i=_j=0,_len1=_ref.length;_j<_len1;i=++_j){shipId=_ref[i];if(shipId!==-1){ship=ownShips[shipId];basicSaku=0;extraSaku=0;extraTyku=0;if(ship.api_sakuteki[0]){basicSaku+=ship.api_sakuteki[0]}shipData=ships[ship.api_ship_id];$("#ship-"+deck.api_id+(i+1)+"-type").text(stypes[shipData.api_stype].api_name);$("#ship-"+deck.api_id+(i+1)+"-exp").text("Next: "+ship.api_exp[1]);fuelPercent=ship.api_fuel*100/shipData.api_fuel_max;currentState="am-progress-bar-success";if(fuelPercent<100){currentState="mg-progress-bar-yellow"}if(fuelPercent<75){currentState="am-progress-bar-warning"}if(fuelPercent<50){currentState="am-progress-bar-danger"}fuelChargeHtml='<div class="am-progress am-progress-sm mg-progress-inline"><div class="am-progress-bar '+currentState+'" style="width: '+fuelPercent+'%"></div></div>';bullPercent=ship.api_bull*100/shipData.api_bull_max;currentState="am-progress-bar-success";if(bullPercent<100){currentState="mg-progress-bar-yellow"}if(bullPercent<75){currentState="am-progress-bar-warning"}if(bullPercent<50){currentState="am-progress-bar-danger"}bullChargeHtml='<div class="am-progress am-progress-sm mg-progress-inline"><div class="am-progress-bar '+currentState+'" style="width: '+bullPercent+'%"></div></div>';$("#ship-"+deck.api_id+(i+1)+"-charge").html(fuelChargeHtml+'<div class="mg-progress-split"></div>'+bullChargeHtml+'<div class="clear"></div>');$("#ship-"+deck.api_id+(i+1)+"-cond").text("Cond. "+ship.api_cond);if(ship.api_cond<20){$("#ship-"+deck.api_id+(i+1)+"-cond").attr("class","mg-red")}else if(ship.api_cond<30){$("#ship-"+deck.api_id+(i+1)+"-cond").attr("class","mg-orange")}else if(ship.api_cond>49){$("#ship-"+deck.api_id+(i+1)+"-cond").attr("class","mg-yellow")}else{$("#ship-"+deck.api_id+(i+1)+"-cond").attr("class","")}$("#ship-"+deck.api_id+(i+1)+"-name").text(ships[ship.api_ship_id].api_name);$("#ship-"+deck.api_id+(i+1)+"-lv").text("Lv. "+ship.api_lv);hpPercent=ship.api_nowhp*100/ship.api_maxhp;currentState="am-progress-bar-success";if(hpPercent<75){currentState="mg-progress-bar-yellow"}if(hpPercent<50){currentState="am-progress-bar-warning"}if(hpPercent<25){currentState="am-progress-bar-danger"}$("#ship-"+deck.api_id+(i+1)+"-hpline").html('<div class="am-progress am-progress-striped"><div class="am-progress-bar '+currentState+'" style="width: '+hpPercent+'%">HP: '+ship.api_nowhp+" / "+ship.api_maxhp+"</div></div>");html='<ul class="am-avg-sm-4">';_ref1=ship.api_slot;for(slotPos=_k=0,_len2=_ref1.length;_k<_len2;slotPos=++_k){slotId=_ref1[slotPos];if(slotPos===4){break}cur="<li></li>";if(slotId!==-1){slot=ownSlotitems[slotId];if(slot!=null){slotData=slotitems[slot.api_slotitem_id];if(slotData.api_type[3]===12||slotData.api_type[3]===13){extraSaku+=slotData.api_saku*2}else if(slotData.api_type[3]>=9&&slotData.api_type[3]<=11){extraSaku+=slotData.api_saku}else if(slotData.api_saku){basicSaku+=slotData.api_saku}if(ship.api_onslot[slotPos]>0&&slotData.api_type[3]>=6&&slotData.api_type[3]<=9&&slotData.api_tyku>0){extraTyku+=Math.floor(slotData.api_tyku*Math.sqrt(ship.api_onslot[slotPos]))}cur='<li><div class="mg-ico-container"><img src="./assets/images/slotitem/'+slotData.api_type[3]+'.png" title="'+slotData.api_name+'"></img></div></li>'}else{cur='<li><div class=""mg-ico-container"><img src="./assets/images/slotitem/0.png" title="？？？"></img></div></li>'}}html+=cur}html+="</ul>";$("#ship-"+deck.api_id+(i+1)+"-equip").html(html);totalShip+=1;totalLv+=ship.api_lv;totalSaku+=Math.floor(Math.sqrt(basicSaku))+extraSaku;totalTyku+=extraTyku}else{$("#ship-"+deck.api_id+(i+1)+"-type").text("");$("#ship-"+deck.api_id+(i+1)+"-exp").text("");$("#ship-"+deck.api_id+(i+1)+"-charge").html("");$("#ship-"+deck.api_id+(i+1)+"-cond").text("");$("#ship-"+deck.api_id+(i+1)+"-cond").attr("class","");$("#ship-"+deck.api_id+(i+1)+"-name").text("");$("#ship-"+deck.api_id+(i+1)+"-lv").text("");$("#ship-"+deck.api_id+(i+1)+"-hpline").html("");$("#ship-"+deck.api_id+(i+1)+"-equip").html("")}}html='<span class="mg-text-split">总计Lv. '+totalLv+"</span>";html+='<span class="mg-text-split">平均Lv. '+(totalLv/totalShip).toFixed(0)+"</span>";html+='<span class="mg-text-split">制空: '+totalTyku+"</span>";html+='<span class="mg-text-split">索敌: '+totalSaku+"</span>";_results.push($("#deck-"+deck.api_id+"-info").html(html))}return _results};exports.refreshNdocks=function(){var ndock,ship,_i,_len,_results;_results=[];for(_i=0,_len=ndocks.length;_i<_len;_i++){ndock=ndocks[_i];if(!ndock){continue}switch(ndock.api_state){case-1:$("#ndock-name-"+ndock.api_id).css("background-color","rgba(221, 81, 76, 0.05)");_results.push($("#ndock-timer-"+ndock.api_id).css("background-color","rgba(221, 81, 76, 0.05)"));break;case 0:$("#ndock-name-"+ndock.api_id).attr("style","");$("#ndock-timer-"+ndock.api_id).attr("style","");$("#ndock-name-"+ndock.api_id).text("");_results.push(ndockTimer[ndock.api_id]=-1);break;case 1:ship=ownShips[ndock.api_ship_id];$("#ndock-name-"+ndock.api_id).attr("style","");$("#ndock-timer-"+ndock.api_id).attr("style","");$("#ndock-name-"+ndock.api_id).text(ships[ship.api_ship_id].api_name);ndockTimer[ndock.api_id]=Math.floor((ndock.api_complete_time-new Date)/1e3);_results.push(ndockNoticed[ndock.api_id]=false);break;default:_results.push(void 0)}}return _results};exports.refreshKdocks=function(){var clearKdock,kdock,materialStr,_i,_len,_results;clearKdock=function(id){$("#kdock-name-"+id).attr("style","");$("#kdock-timer-"+id).attr("style","");$("#kdock-"+id+"-name").attr("style","");$("#kdock-"+id+"-remaining").attr("style","");$("#kdock-"+id+"-material").attr("style","");$("#kdock-"+id+"-name").text("");$("#kdock-name-"+id).text("");return $("#kdock-"+id+"-material").html("")};_results=[];for(_i=0,_len=kdocks.length;_i<_len;_i++){kdock=kdocks[_i];if(!kdock){continue}switch(kdock.api_state){case-1:clearKdock(kdock.api_id);$("#kdock-name-"+kdock.api_id).css("background-color","rgba(221, 81, 76, 0.05)");$("#kdock-timer-"+kdock.api_id).css("background-color","rgba(221, 81, 76, 0.05)");$("#kdock-"+kdock.api_id+"-name").css("background-color","rgba(221, 81, 76, 0.05)");$("#kdock-"+kdock.api_id+"-remaining").css("background-color","rgba(221, 81, 76, 0.05)");_results.push($("#kdock-"+kdock.api_id+"-material").css("background-color","rgba(221, 81, 76, 0.05)"));break;case 0:clearKdock(kdock.api_id);_results.push(kdockTimer[kdock.api_id]=-1);break;case 1:clearKdock(kdock.api_id);$("#kdock-name-"+kdock.api_id).css("color","#DD514C");$("#kdock-timer-"+kdock.api_id).css("color","#DD514C");$("#kdock-"+kdock.api_id+"-name").css("color","#DD514C");$("#kdock-"+kdock.api_id+"-remaining").css("color","#DD514C");$("#kdock-"+kdock.api_id+"-material").css("color","#DD514C");$("#kdock-"+kdock.api_id+"-name").text(ships[kdock.api_created_ship_id].api_name);$("#kdock-name-"+kdock.api_id).text(ships[kdock.api_created_ship_id].api_name);kdockTimer[kdock.api_id]=Math.floor((kdock.api_complete_time-new Date)/1e3);kdockNoticed[kdock.api_id]=false;materialStr=getMaterialImgTag(1)+" "+kdock.api_item1+" "+getMaterialImgTag(2)+" "+kdock.api_item2+" "+getMaterialImgTag(3)+" "+kdock.api_item3+" "+getMaterialImgTag(4)+" "+kdock.api_item4+" "+getMaterialImgTag(7)+" "+kdock.api_item5;_results.push($("#kdock-"+kdock.api_id+"-material").html(materialStr));break;case 2:clearKdock(kdock.api_id);if(kdock.api_item1>999||kdock.api_item2>999||kdock.api_item3>999||kdock.api_item4>999){$("#kdock-name-"+kdock.api_id).css("color","#DD514C");$("#kdock-timer-"+kdock.api_id).css("color","#DD514C");$("#kdock-"+kdock.api_id+"-name").css("color","#DD514C");$("#kdock-"+kdock.api_id+"-remaining").css("color","#DD514C");$("#kdock-"+kdock.api_id+"-material").css("color","#DD514C")}$("#kdock-"+kdock.api_id+"-name").text(ships[kdock.api_created_ship_id].api_name);$("#kdock-name-"+kdock.api_id).text(ships[kdock.api_created_ship_id].api_name);kdockTimer[kdock.api_id]=Math.floor((kdock.api_complete_time-new Date)/1e3);kdockNoticed[kdock.api_id]=false;materialStr=getMaterialImgTag(1)+" "+kdock.api_item1+" "+getMaterialImgTag(2)+" "+kdock.api_item2+" "+getMaterialImgTag(3)+" "+kdock.api_item3+" "+getMaterialImgTag(4)+" "+kdock.api_item4+" "+getMaterialImgTag(7)+" "+kdock.api_item5;_results.push($("#kdock-"+kdock.api_id+"-material").html(materialStr));break;case 3:$("#kdock-"+kdock.api_id+"-name").text(ships[kdock.api_created_ship_id].api_name);$("#kdock-name-"+kdock.api_id).text(ships[kdock.api_created_ship_id].api_name);kdockTimer[kdock.api_id]=0;materialStr=getMaterialImgTag(1)+" "+kdock.api_item1+" "+getMaterialImgTag(2)+" "+kdock.api_item2+" "+getMaterialImgTag(3)+" "+kdock.api_item3+" "+getMaterialImgTag(4)+" "+kdock.api_item4+" "+getMaterialImgTag(7)+" "+kdock.api_item5;_results.push($("#kdock-"+kdock.api_id+"-material").html(materialStr));break;default:_results.push(void 0)}}return _results};exports.refreshCreateitem=function(){var createItemId,str;switch(createItem.api_create_flag){case 0:$("#createitem-state").attr("class","am-btn am-btn-danger");$("#createitem-state").text("失败");str=createItem.api_fdata;createItemId=parseInt(str.split(",")[1]);$("#createitem-name").text(slotitems[createItemId].api_name);return $("#createitem-state").show();case 1:$("#createitem-state").attr("class","am-btn am-btn-success");$("#createitem-state").text("成功");$("#createitem-name").text(slotitems[createItem.api_slot_item.api_slotitem_id].api_name);return $("#createitem-state").show()}};exports.refreshExperience=function(){var html,list,nextLv,ship,_i,_j,_len,_len1;list=[];for(_i=0,_len=ownShips.length;_i<_len;_i++){ship=ownShips[_i];if(ship){list.push(ship)}}list.sort(function(a,b){return b.api_exp[0]-a.api_exp[0]});html='<option value=",,">下拉列表选择舰娘</option>';for(_j=0,_len1=list.length;_j<_len1;_j++){ship=list[_j];nextLv=150;if(ship.api_lv<99){nextLv=99}if(ships[ship.api_ship_id].api_afterlv!==0&&ships[ship.api_ship_id].api_afterlv>ship.api_lv){nextLv=Math.min(nextLv,ships[ship.api_ship_id].api_afterlv)}html+='<option value="'+ship.api_lv+","+ship.api_exp[1]+","+nextLv+'">Lv. '+ship.api_lv+" - "+ships[ship.api_ship_id].api_name+"</option>"}return $("#exp-ship").html(html)};exports.calcExperience=function(){var deltaExp,goalExp,html,mapExp,nowExp;nowExp=exp[parseInt($("#exp-lv").val())+1]-parseInt($("#exp-next").val());goalExp=exp[parseInt($("#exp-goal").val())];deltaExp=0;if(goalExp>nowExp){deltaExp=goalExp-nowExp}mapExp=parseInt($("#exp-map").val())*parseFloat($("#exp-result").val());html='<ul style="text-align: left;"><li>达到等级需要经验: '+deltaExp+"</li>";html+="<li>基本: "+mapExp+" 需"+Math.ceil(deltaExp/mapExp)+"场</li>";html+="<li>旗舰: "+mapExp*1.5+" 需"+Math.ceil(deltaExp/mapExp/1.5)+"场</li>";html+="<li>MVP: "+mapExp*2+" 需"+Math.ceil(deltaExp/mapExp/2)+"场</li>";html+="<li>旗舰MVP: "+mapExp*3+" 需"+Math.ceil(deltaExp/mapExp/3)+"场</li></ul>";return exports.showModalHtml("经验计算",html)}}).call(this);